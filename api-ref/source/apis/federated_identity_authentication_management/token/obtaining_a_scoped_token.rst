:original_name: iam_13_0604.html

.. _iam_13_0604:

Obtaining a Scoped Token
========================

Function
--------

This API is used to obtain a scoped token through federated identity authentication.

URI
---

POST /v3/auth/tokens

Request Parameters
------------------

.. table:: **Table 1** Parameters in the request header

   +--------------+-----------+--------+-------------------------------------------------------+
   | Parameter    | Mandatory | Type   | Description                                           |
   +==============+===========+========+=======================================================+
   | Content-Type | No        | String | Fill **application/json;charset=utf8** in this field. |
   +--------------+-----------+--------+-------------------------------------------------------+

.. table:: **Table 2** Parameters in the request body

   +----------------------------------------------------------------------+-----------+--------+-----------------------------+
   | Parameter                                                            | Mandatory | Type   | Description                 |
   +======================================================================+===========+========+=============================+
   | :ref:`auth <iam_13_0604__en-us_topic_0224276934_request_rq1363auth>` | Yes       | Object | Authentication information. |
   +----------------------------------------------------------------------+-----------+--------+-----------------------------+

.. _iam_13_0604__en-us_topic_0224276934_request_rq1363auth:

.. table:: **Table 3** auth

   +----------------------------------------------------------------------------------+-----------+--------+-----------------------------------------------------------------------------+
   | Parameter                                                                        | Mandatory | Type   | Description                                                                 |
   +==================================================================================+===========+========+=============================================================================+
   | :ref:`identity <iam_13_0604__en-us_topic_0224276934_request_rq1363authidentity>` | Yes       | Object | Authentication parameters.                                                  |
   +----------------------------------------------------------------------------------+-----------+--------+-----------------------------------------------------------------------------+
   | :ref:`scope <iam_13_0604__en-us_topic_0224276934_request_rq1363authscope>`       | Yes       | Object | Application scope of the token. The value can be **project** or **domain**. |
   +----------------------------------------------------------------------------------+-----------+--------+-----------------------------------------------------------------------------+

.. _iam_13_0604__en-us_topic_0224276934_request_rq1363authidentity:

.. table:: **Table 4** auth.identity

   +------------------------------------------------------------------------------------+-----------+------------------+--------------------------------------------------------------+
   | Parameter                                                                          | Mandatory | Type             | Description                                                  |
   +====================================================================================+===========+==================+==============================================================+
   | methods                                                                            | Yes       | Array of strings | Authentication method. The value of this field is **token**. |
   +------------------------------------------------------------------------------------+-----------+------------------+--------------------------------------------------------------+
   | :ref:`token <iam_13_0604__en-us_topic_0224276934_request_rq1363authidentitytoken>` | Yes       | Object           | Unscoped token information.                                  |
   +------------------------------------------------------------------------------------+-----------+------------------+--------------------------------------------------------------+

.. _iam_13_0604__en-us_topic_0224276934_request_rq1363authidentitytoken:

.. table:: **Table 5** auth.identity.token

   ========= ========= ====== ==================
   Parameter Mandatory Type   Description
   ========= ========= ====== ==================
   id        Yes       String Unscoped token ID.
   ========= ========= ====== ==================

.. _iam_13_0604__en-us_topic_0224276934_request_rq1363authscope:

.. table:: **Table 6** auth.scope

   +-------------------------------------------------------------------------------------+-----------+--------+--------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                                                                           | Mandatory | Type   | Description                                                                                                                                |
   +=====================================================================================+===========+========+============================================================================================================================================+
   | :ref:`domain <iam_13_0604__en-us_topic_0224276934_request_rq1363authscopedomain>`   | No        | Object | If this field is set to **domain**, the token can be used to access resources in all projects under the account of a specified ID or name. |
   +-------------------------------------------------------------------------------------+-----------+--------+--------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`project <iam_13_0604__en-us_topic_0224276934_request_rq1363authscopeproject>` | No        | Object | If this field is set to **project**, the token can only be used to access resources in the project of a specified ID or name.              |
   +-------------------------------------------------------------------------------------+-----------+--------+--------------------------------------------------------------------------------------------------------------------------------------------+

.. _iam_13_0604__en-us_topic_0224276934_request_rq1363authscopedomain:

.. table:: **Table 7** auth.scope.domain

   +-----------+-----------+--------+-----------------------------------------------------------+
   | Parameter | Mandatory | Type   | Description                                               |
   +===========+===========+========+===========================================================+
   | id        | No        | String | Domain ID. Either **id** or **name** must be specified.   |
   +-----------+-----------+--------+-----------------------------------------------------------+
   | name      | No        | String | Domain name. Either **id** or **name** must be specified. |
   +-----------+-----------+--------+-----------------------------------------------------------+

.. _iam_13_0604__en-us_topic_0224276934_request_rq1363authscopeproject:

.. table:: **Table 8** auth.scope.project

   +--------------------------------------------------+-----------+--------+-----------------------------------------------------------------------------------+
   | Parameter                                        | Mandatory | Type   | Description                                                                       |
   +==================================================+===========+========+===================================================================================+
   | :ref:`domain <iam_13_0604__table11966185019243>` | No        | Object | Domain information. This parameter is mandatory if the **name** parameter is set. |
   +--------------------------------------------------+-----------+--------+-----------------------------------------------------------------------------------+
   | id                                               | No        | String | Project ID. Either **id** or **name** must be specified.                          |
   +--------------------------------------------------+-----------+--------+-----------------------------------------------------------------------------------+
   | name                                             | No        | String | Project name. Either **id** or **name** must be specified.                        |
   +--------------------------------------------------+-----------+--------+-----------------------------------------------------------------------------------+

.. _iam_13_0604__table11966185019243:

.. table:: **Table 9** auth.scope.project.domain

   +-----------+-----------+--------+-----------------------------------------------------------+
   | Parameter | Mandatory | Type   | Description                                               |
   +===========+===========+========+===========================================================+
   | id        | No        | string | Domain ID. Either **id** or **name** must be specified.   |
   +-----------+-----------+--------+-----------------------------------------------------------+
   | name      | No        | string | Domain name. Either **id** or **name** must be specified. |
   +-----------+-----------+--------+-----------------------------------------------------------+

Response Parameters
-------------------

.. table:: **Table 10** Parameters in the response header

   =============== ====== ====================
   Parameter       Type   Description
   =============== ====== ====================
   X-Subject-Token string Signed scoped token.
   =============== ====== ====================

.. table:: **Table 11** Parameters in the response body

   +-------------------------------------------------------------------------+--------+------------------------------+
   | Parameter                                                               | Type   | Description                  |
   +=========================================================================+========+==============================+
   | :ref:`token <iam_13_0604__en-us_topic_0224276934_response_rs1363token>` | Object | Details of the scoped token. |
   +-------------------------------------------------------------------------+--------+------------------------------+

.. _iam_13_0604__en-us_topic_0224276934_response_rs1363token:

.. table:: **Table 12** token

   +-----------------------------------------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                                                                               | Type             | Description                                                                                                                                                                 |
   +=========================================================================================+==================+=============================================================================================================================================================================+
   | methods                                                                                 | Array of strings | Method for obtaining the token.                                                                                                                                             |
   +-----------------------------------------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | expires_at                                                                              | String           | Time when the token will expire.                                                                                                                                            |
   +-----------------------------------------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`catalog <iam_13_0604__en-us_topic_0224276934_response_rs1363tokencatalogarritem>` | Array of objects | Catalog information.                                                                                                                                                        |
   +-----------------------------------------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`domain <iam_13_0604__en-us_topic_0224276934_response_rs1363tokendomain>`          | Object           | Domain information of the IAM user who requests for the token. This parameter is returned only when the **scope** parameter in the request body has been set to **domain**. |
   +-----------------------------------------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`project <iam_13_0604__en-us_topic_0224276934_response_rs1363tokenproject>`        | Object           | Project information of the user. This parameter is returned only when the **scope** parameter in the request body has been set to **project**.                              |
   +-----------------------------------------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`roles <iam_13_0604__en-us_topic_0224276934_response_rs1363tokenrolesarritem>`     | Array of objects | Permissions information of the token.                                                                                                                                       |
   +-----------------------------------------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`user <iam_13_0604__en-us_topic_0224276934_response_rs1363tokenuser>`              | Object           | Information about the user who requests for the token.                                                                                                                      |
   +-----------------------------------------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | issued_at                                                                               | String           | Time when the token was issued.                                                                                                                                             |
   +-----------------------------------------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _iam_13_0604__en-us_topic_0224276934_response_rs1363tokencatalogarritem:

.. table:: **Table 13** token.catalog

   +-----------------------------------------------------------------------------------------------------------+------------------+-----------------------------------------------+
   | Parameter                                                                                                 | Type             | Description                                   |
   +===========================================================================================================+==================+===============================================+
   | type                                                                                                      | String           | Type of the service to which the API belongs. |
   +-----------------------------------------------------------------------------------------------------------+------------------+-----------------------------------------------+
   | id                                                                                                        | String           | Service ID.                                   |
   +-----------------------------------------------------------------------------------------------------------+------------------+-----------------------------------------------+
   | name                                                                                                      | String           | Service name.                                 |
   +-----------------------------------------------------------------------------------------------------------+------------------+-----------------------------------------------+
   | :ref:`endpoints <iam_13_0604__en-us_topic_0224276934_response_rs1363tokencatalogarritemendpointsarritem>` | Array of objects | Endpoint information.                         |
   +-----------------------------------------------------------------------------------------------------------+------------------+-----------------------------------------------+

.. _iam_13_0604__en-us_topic_0224276934_response_rs1363tokencatalogarritemendpointsarritem:

.. table:: **Table 14** token.catalog.endpoints

   +-----------+--------+------------------------------------------------------------------------------------------+
   | Parameter | Type   | Description                                                                              |
   +===========+========+==========================================================================================+
   | url       | String | Endpoint URL.                                                                            |
   +-----------+--------+------------------------------------------------------------------------------------------+
   | region    | String | Region to which the endpoint belongs.                                                    |
   +-----------+--------+------------------------------------------------------------------------------------------+
   | region_id | String | Region ID.                                                                               |
   +-----------+--------+------------------------------------------------------------------------------------------+
   | interface | String | Visibility of the API. **public** indicates that the API is available for public access. |
   +-----------+--------+------------------------------------------------------------------------------------------+
   | id        | String | Endpoint ID.                                                                             |
   +-----------+--------+------------------------------------------------------------------------------------------+

.. _iam_13_0604__en-us_topic_0224276934_response_rs1363tokendomain:

.. table:: **Table 15** token.domain

   ========= ====== ============
   Parameter Type   Description
   ========= ====== ============
   name      String Domain name.
   id        String Domain ID.
   ========= ====== ============

.. _iam_13_0604__en-us_topic_0224276934_response_rs1363tokenproject:

.. table:: **Table 16** token.project

   +---------------------------------------------------------------------------------------+--------+------------------------------------+
   | Parameter                                                                             | Type   | Description                        |
   +=======================================================================================+========+====================================+
   | name                                                                                  | String | Project name.                      |
   +---------------------------------------------------------------------------------------+--------+------------------------------------+
   | id                                                                                    | String | Project ID.                        |
   +---------------------------------------------------------------------------------------+--------+------------------------------------+
   | :ref:`domain <iam_13_0604__en-us_topic_0224276934_response_rs1363tokenprojectdomain>` | Object | Domain information of the project. |
   +---------------------------------------------------------------------------------------+--------+------------------------------------+

.. _iam_13_0604__en-us_topic_0224276934_response_rs1363tokenprojectdomain:

.. table:: **Table 17** token.project.domain

   ========= ====== ============
   Parameter Type   Description
   ========= ====== ============
   name      String Domain name.
   id        String Domain ID.
   ========= ====== ============

.. _iam_13_0604__en-us_topic_0224276934_response_rs1363tokenrolesarritem:

.. table:: **Table 18** token.roles

   +-----------+--------+-----------------------------------------------------------------------------------------+
   | Parameter | Type   | Description                                                                             |
   +===========+========+=========================================================================================+
   | name      | String | Permission name.                                                                        |
   +-----------+--------+-----------------------------------------------------------------------------------------+
   | id        | String | Permission ID. The default value is **0**, which does not correspond to any permission. |
   +-----------+--------+-----------------------------------------------------------------------------------------+

.. _iam_13_0604__en-us_topic_0224276934_response_rs1363tokenuser:

.. table:: **Table 19** token.user

   +-------------------------------------------------------------------------------------------------+--------+----------------------------------------------------------------------------------------------------------------------------+
   | Parameter                                                                                       | Type   | Description                                                                                                                |
   +=================================================================================================+========+============================================================================================================================+
   | :ref:`domain <iam_13_0604__en-us_topic_0224276934_response_rs1363tokenuserdomain>`              | Object | Information about the domain used to create the user.                                                                      |
   +-------------------------------------------------------------------------------------------------+--------+----------------------------------------------------------------------------------------------------------------------------+
   | :ref:`OS-FEDERATION <iam_13_0604__en-us_topic_0224276934_response_rs1363tokenuserosfederation>` | Object | Federated identity authentication information.                                                                             |
   +-------------------------------------------------------------------------------------------------+--------+----------------------------------------------------------------------------------------------------------------------------+
   | id                                                                                              | String | User ID.                                                                                                                   |
   +-------------------------------------------------------------------------------------------------+--------+----------------------------------------------------------------------------------------------------------------------------+
   | name                                                                                            | String | Username.                                                                                                                  |
   +-------------------------------------------------------------------------------------------------+--------+----------------------------------------------------------------------------------------------------------------------------+
   | password_expires_at                                                                             | String | UTC time when the password will expire. If this parameter is empty, it indicates that the password has unlimited validity. |
   +-------------------------------------------------------------------------------------------------+--------+----------------------------------------------------------------------------------------------------------------------------+

.. _iam_13_0604__en-us_topic_0224276934_response_rs1363tokenuserdomain:

.. table:: **Table 20** token.user.domain

   ========= ====== ============
   Parameter Type   Description
   ========= ====== ============
   name      String Domain name.
   id        String Domain ID.
   ========= ====== ============

.. _iam_13_0604__en-us_topic_0224276934_response_rs1363tokenuserosfederation:

.. table:: **Table 21** token.user.OS-FEDERATION

   +---------------------------------------------------------------------------------------------------------------------+------------------+--------------------------------+
   | Parameter                                                                                                           | Type             | Description                    |
   +=====================================================================================================================+==================+================================+
   | :ref:`groups <iam_13_0604__en-us_topic_0224276934_response_rs1363tokenuserosfederationgroupsarritem>`               | Array of objects | User group information.        |
   +---------------------------------------------------------------------------------------------------------------------+------------------+--------------------------------+
   | :ref:`identity_provider <iam_13_0604__en-us_topic_0224276934_response_rs1363tokenuserosfederationidentityprovider>` | Object           | Identity provider information. |
   +---------------------------------------------------------------------------------------------------------------------+------------------+--------------------------------+
   | :ref:`protocol <iam_13_0604__en-us_topic_0224276934_response_rs1363tokenuserosfederationprotocol>`                  | Object           | Protocol information.          |
   +---------------------------------------------------------------------------------------------------------------------+------------------+--------------------------------+

.. _iam_13_0604__en-us_topic_0224276934_response_rs1363tokenuserosfederationgroupsarritem:

.. table:: **Table 22** token.user.OS-FEDERATION.groups

   ========= ====== ================
   Parameter Type   Description
   ========= ====== ================
   id        String User group ID.
   name      String User group name.
   ========= ====== ================

.. _iam_13_0604__en-us_topic_0224276934_response_rs1363tokenuserosfederationidentityprovider:

.. table:: **Table 23** token.user.OS-FEDERATION.identity_provider

   ========= ====== =====================
   Parameter Type   Description
   ========= ====== =====================
   id        String Identity provider ID.
   ========= ====== =====================

.. _iam_13_0604__en-us_topic_0224276934_response_rs1363tokenuserosfederationprotocol:

.. table:: **Table 24** token.user.OS-FEDERATION.protocol

   ========= ====== ============
   Parameter Type   Description
   ========= ====== ============
   id        String Protocol ID.
   ========= ====== ============

Example Request
---------------

.. code-block:: text

   POST https://sample.domain.com/v3/auth/tokens

.. code-block::

   {
       "auth": {
           "identity": {
               "methods": [
                   "token"
               ],
               "token": {
                   "id": "MIIatAYJKoZIhvcNAQcCoIIapTCCGqECAQExDTALB..."
               }
           },
           "scope": {
               "domain": {
                   "id": "063bb260a480cecc0f36c0086bb6c..."
               }
           }
       }
   }

Example Response
----------------

**Status code: 201**

The scoped token is obtained successfully.

.. code-block::

   Parameters in the response header
   X-Subject-Token:MIIatAYJKoZIhvcNAQcCoIIapTCCGqECAQExDTALB...

.. code-block::

   Parameters in the response body
   {
       "token": {
           "expires_at": "2020-02-13T14:21:34.042000Z",
           "methods": [
               "token"
           ],
           "catalog": [
               {
                   "endpoints": [
                       {
                           "id": "d2983f677ce14f1e81cbb6a9345a1...",
                           "interface": "public",
                           "region": "*",
                           "region_id": "*",
                           "url": "https://sample.domain.com/v3"
                       }
                   ],
                   "id": "fd631b3426cb40f0919091d5861d8...",
                   "name": "keystone",
                   "type": "identity"
               }
           ],
           "domain": {
               "id": "06aa2260a480cecc0f36c0086bb6cfe0",
               "name": "IAMDomain"
           },
           "roles": [
               {
                   "id": "0",
                   "name": "te_admin"
               },
               {
                   "id": "0",
                   "name": "secu_admin"
               }
           ],
           "issued_at": "2020-02-12T14:21:34.042000Z",
           "user": {
               "OS-FEDERATION": {
                   "groups": [
                       {
                           "id": "06aa2260bb00cecc3f3ac0084a74038f",
                           "name": "admin"
                       }
                   ],
                   "identity_provider": {
                       "id": "ACME"
                   },
                   "protocol": {
                       "id": "saml"
                   }
               },
               "domain": {
                   "id": "06aa2260a480cecc0f36c0086bb6cfe0",
                   "name": "IAMDomain"
               },
               "id": "LdQTDSC7zmJVIic3yaCbLBXDxPAdDxLg",
               "name": "FederationUser",
               "password_expires_at": ""
           }
       }
   }

Status Codes
------------

=========== ==========================================
Status Code Description
=========== ==========================================
201         The scoped token is obtained successfully.
400         The server failed to process the request.
401         Authentication failed.
403         Access denied.
404         The requested resource cannot be found.
500         Internal server error.
503         Service unavailable.
=========== ==========================================

Error Codes
-----------

None
