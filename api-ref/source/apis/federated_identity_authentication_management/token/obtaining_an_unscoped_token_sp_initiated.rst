:original_name: en-us_topic_0057845629.html

.. _en-us_topic_0057845629:

Obtaining an Unscoped Token (SP Initiated)
==========================================

Function
--------

This API is used to obtain an unscoped token in SP-initiated federated identity authentication mode.

An unscoped token cannot be used for authentication. If a federated user needs to use a token for authentication, obtain the scoped token based on section :ref:`Obtaining a Scoped Token <iam_13_0604>`.

URI
---

-  URI format

   GET /v3/OS-FEDERATION/identity_providers/{idp_id}/protocols/{protocol_id}/auth

-  URI parameters

   =========== ========= ====== ===========================
   Parameter   Mandatory Type   Description
   =========== ========= ====== ===========================
   idp_id      Yes       String ID of an identity provider.
   protocol_id Yes       String ID of a protocol.
   =========== ========= ====== ===========================

Request Parameters
------------------

-  Parameters in the request header

   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                                                                                                  |
   +=================+=================+=================+==============================================================================================================+
   | Accept          | No              | String          | -  This parameter is not required when a token is obtained in the WebSSO mode.                               |
   |                 |                 |                 |                                                                                                              |
   |                 |                 |                 | -  When you obtain a token using the Enhanced Client Proxy (ECP), the value of this parameter is as follows: |
   |                 |                 |                 |                                                                                                              |
   |                 |                 |                 |    application/vnd.paos+xml                                                                                  |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------+
   | PAOS            | No              | String          | -  This parameter is not required when a token is obtained in the WebSSO mode.                               |
   |                 |                 |                 |                                                                                                              |
   |                 |                 |                 | -  When you obtain a token using the ECP, the value of this parameter is as follows:                         |
   |                 |                 |                 |                                                                                                              |
   |                 |                 |                 |    urn:oasis:names:tc:SAML:2.0:profiles:SSO:ecp                                                              |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------+

   .. note::

      #. This API can be used to obtain tokens through WebSSO and ECP. Different request headers are used to determine the method of obtaining a token. For details, see the parameter description of Request Header.
      #. You are not advised to obtain a token by directly calling this API. You are advised to obtain a token using OpenStackClient.

-  Example request

   .. code-block:: text

      GET /v3/OS-FEDERATION/identity_providers/idptest/protocols/saml/auth

Response Parameters
-------------------

-  Parameters in the response header

   =============== ====== ======================
   Response Item   Type   Description
   =============== ====== ======================
   X-Subject-Token String Signed unscoped token.
   =============== ====== ======================

-  Parameters in the response body

   +---------------------------------------------------------+--------+---------------------------------------------+
   | Parameter                                               | Type   | Description                                 |
   +=========================================================+========+=============================================+
   | :ref:`token <en-us_topic_0057845629__li17456172519548>` | object | Federated authentication token information. |
   +---------------------------------------------------------+--------+---------------------------------------------+

-  .. _en-us_topic_0057845629__li17456172519548:

   token

   +-----------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                                                 | Type             | Description                                                                                                                                                                 |
   +===========================================================+==================+=============================================================================================================================================================================+
   | methods                                                   | Array of strings | Method for obtaining the token.                                                                                                                                             |
   +-----------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | expires_at                                                | string           | Time when the token will expire.                                                                                                                                            |
   +-----------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`catalog <en-us_topic_0057845629__li312874265611>`   | Array of objects | Catalog information.                                                                                                                                                        |
   +-----------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`domain <en-us_topic_0057845629__li5635203725616>`   | object           | Domain information of the IAM user who requests for the token. This parameter is returned only when the **scope** parameter in the request body has been set to **domain**. |
   +-----------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`project <en-us_topic_0057845629__li85221335125613>` | object           | Project information of the user who requests for the token. This parameter is returned only when the **scope** parameter in the request body has been set to **project**.   |
   +-----------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`roles <en-us_topic_0057845629__li9263143118566>`    | Array of objects | Permissions information of the token.                                                                                                                                       |
   +-----------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`user <en-us_topic_0057845629__li1866422819564>`     | object           | Information about the user who requests for the token.                                                                                                                      |
   +-----------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | issued_at                                                 | string           | Time when the token was issued.                                                                                                                                             |
   +-----------------------------------------------------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

-  .. _en-us_topic_0057845629__li312874265611:

   token.catalog

   +----------------------------------------------------------+------------------+-----------------------------------------------+
   | Parameter                                                | Type             | Description                                   |
   +==========================================================+==================+===============================================+
   | type                                                     | string           | Type of the service to which the API belongs. |
   +----------------------------------------------------------+------------------+-----------------------------------------------+
   | id                                                       | string           | Service ID.                                   |
   +----------------------------------------------------------+------------------+-----------------------------------------------+
   | name                                                     | string           | Service name.                                 |
   +----------------------------------------------------------+------------------+-----------------------------------------------+
   | :ref:`endpoints <en-us_topic_0057845629__li31276402568>` | Array of objects | Endpoint information.                         |
   +----------------------------------------------------------+------------------+-----------------------------------------------+

-  .. _en-us_topic_0057845629__li31276402568:

   token.catalog.endpoints

   +-----------+--------+------------------------------------------------------------------------------------------+
   | Parameter | Type   | Description                                                                              |
   +===========+========+==========================================================================================+
   | url       | string | Endpoint URL.                                                                            |
   +-----------+--------+------------------------------------------------------------------------------------------+
   | region    | string | Region to which the endpoint belongs.                                                    |
   +-----------+--------+------------------------------------------------------------------------------------------+
   | region_id | string | Region ID.                                                                               |
   +-----------+--------+------------------------------------------------------------------------------------------+
   | interface | string | Visibility of the API. **public** indicates that the API is available for public access. |
   +-----------+--------+------------------------------------------------------------------------------------------+
   | id        | string | Endpoint ID.                                                                             |
   +-----------+--------+------------------------------------------------------------------------------------------+

-  .. _en-us_topic_0057845629__li5635203725616:

   token.domain

   ========= ====== ============
   Parameter Type   Description
   ========= ====== ============
   name      string Domain name.
   id        string Domain ID.
   ========= ====== ============

-  .. _en-us_topic_0057845629__li85221335125613:

   token.project

   +----------------------------------------------------------+--------+------------------------------------+
   | Parameter                                                | Type   | Description                        |
   +==========================================================+========+====================================+
   | name                                                     | string | Project name.                      |
   +----------------------------------------------------------+--------+------------------------------------+
   | id                                                       | string | Project ID.                        |
   +----------------------------------------------------------+--------+------------------------------------+
   | :ref:`domain <en-us_topic_0057845629__li11227833145613>` | object | Domain information of the project. |
   +----------------------------------------------------------+--------+------------------------------------+

-  .. _en-us_topic_0057845629__li11227833145613:

   token.project.domain

   ========= ====== ============
   Parameter Type   Description
   ========= ====== ============
   name      string Domain name.
   id        string Domain ID.
   ========= ====== ============

-  .. _en-us_topic_0057845629__li9263143118566:

   token.roles

   +-----------+--------+-----------------------------------------------------------------------------------------+
   | Parameter | Type   | Description                                                                             |
   +===========+========+=========================================================================================+
   | name      | string | Permission name.                                                                        |
   +-----------+--------+-----------------------------------------------------------------------------------------+
   | id        | string | Permission ID. The default value is **0**, which does not correspond to any permission. |
   +-----------+--------+-----------------------------------------------------------------------------------------+

-  .. _en-us_topic_0057845629__li1866422819564:

   token.user

   +----------------------------------------------------------------+--------+------------------------------------------------------------------------------------------------------+
   | Parameter                                                      | Type   | Description                                                                                          |
   +================================================================+========+======================================================================================================+
   | :ref:`domain <en-us_topic_0057845629__li135322675610>`         | object | Information about the domain to which the user belongs.                                              |
   +----------------------------------------------------------------+--------+------------------------------------------------------------------------------------------------------+
   | :ref:`OS-FEDERATION <en-us_topic_0057845629__li8637182325618>` | object | Federated identity authentication information.                                                       |
   +----------------------------------------------------------------+--------+------------------------------------------------------------------------------------------------------+
   | id                                                             | string | User ID.                                                                                             |
   +----------------------------------------------------------------+--------+------------------------------------------------------------------------------------------------------+
   | name                                                           | string | Username.                                                                                            |
   +----------------------------------------------------------------+--------+------------------------------------------------------------------------------------------------------+
   | password_expires_at                                            | string | UTC time when the password will expire. If this parameter is empty (""), the password never expires. |
   +----------------------------------------------------------------+--------+------------------------------------------------------------------------------------------------------+

-  .. _en-us_topic_0057845629__li135322675610:

   token.user.domain

   ========= ====== ============
   Parameter Type   Description
   ========= ====== ============
   name      string Domain name.
   id        string Domain ID.
   ========= ====== ============

-  .. _en-us_topic_0057845629__li8637182325618:

   token.user.OS-FEDERATION

   +-------------------------------------------------------------------+------------------+--------------------------------+
   | Parameter                                                         | Type             | Description                    |
   +===================================================================+==================+================================+
   | :ref:`groups <en-us_topic_0057845629__li7665721195619>`           | Array of objects | User group information.        |
   +-------------------------------------------------------------------+------------------+--------------------------------+
   | :ref:`identity_provider <en-us_topic_0057845629__li129312208565>` | object           | Identity provider information. |
   +-------------------------------------------------------------------+------------------+--------------------------------+
   | :ref:`protocol <en-us_topic_0057845629__li7335121885610>`         | object           | Protocol information.          |
   +-------------------------------------------------------------------+------------------+--------------------------------+

-  .. _en-us_topic_0057845629__li7665721195619:

   token.user.OS-FEDERATION.groups

   ========= ====== ================
   Parameter Type   Description
   ========= ====== ================
   id        string User group ID.
   name      string User group name.
   ========= ====== ================

-  .. _en-us_topic_0057845629__li129312208565:

   token.user.OS-FEDERATION.identity_provider

   ========= ====== =====================
   Parameter Type   Description
   ========= ====== =====================
   id        string Identity provider ID.
   ========= ====== =====================

-  .. _en-us_topic_0057845629__li7335121885610:

   token.user.OS-FEDERATION.protocol

   ========= ====== ============
   Parameter Type   Description
   ========= ====== ============
   id        string Protocol ID.
   ========= ====== ============

-  Example response

   .. code-block::

      {
          "token": {
              "issued_at": "2017-05-23T06:54:51.763000Z",
              "expires_at": "2017-05-24T06:54:51.763000Z",
              "methods": [
                  "mapped"
              ],
              "user": {
                  "domain": {
                      "id": "e31ac82d778b4d128cb6fed37fd72cdb",
                      "name": "exampledomain"
                  },
                  "id": "RMQTgtjjSNGDcKy7oUmI3AZg7GgsWG0Z",
                  "name": "exampleuser",
                  "OS-FEDERATION": {
                      "identity_provider": {
                          "id": "exampleuser"
                      },
                      "protocol": {
                          "id": "saml"
                      },
                      "groups": [
                          {
                              "id": "b40189e26ea44f959877621b4b298db5"
                          }
                      ]
                  }
              }
          }
      }

Status Code
-----------

+-------------+-------------------------------------------------------------------------------------------------------------------------------------------+
| Status Code | Description                                                                                                                               |
+=============+===========================================================================================================================================+
| 200         | The request is successful. You need to further obtain user information.                                                                   |
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------+
| 201         | The request is successful, and a token is returned.                                                                                       |
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------+
| 302         | The system switches to the identity provider authentication page if the request does not carry user information of the identity provider. |
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------+
| 400         | The server failed to process the request.                                                                                                 |
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------+
| 401         | Authentication failed.                                                                                                                    |
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------+
| 403         | Access denied.                                                                                                                            |
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------+
| 405         | The method specified in the request is not allowed for the requested resource.                                                            |
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------+
| 413         | The request entity is too large.                                                                                                          |
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------+
| 500         | Internal server error.                                                                                                                    |
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------+
| 503         | Service unavailable.                                                                                                                      |
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------+
