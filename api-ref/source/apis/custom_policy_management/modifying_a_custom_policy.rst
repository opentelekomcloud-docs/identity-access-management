:original_name: iam_11_0017.html

.. _iam_11_0017:

Modifying a Custom Policy
=========================

Function
--------

This API is provided for the administrator to modify a custom policy.

The API can be called using both the global endpoint and region-specific endpoints.

URI
---

PATCH /v3.0/OS-ROLE/roles/{role_id}

.. table:: **Table 1** URI parameters

   +-----------+-----------+--------+------------------------------------------------------------------------------------------------------------------+
   | Parameter | Mandatory | Type   | Description                                                                                                      |
   +===========+===========+========+==================================================================================================================+
   | role_id   | Yes       | String | Custom policy ID. For details about how to obtain a custom policy ID, see :ref:`Custom Policy ID <iam_02_0011>`. |
   +-----------+-----------+--------+------------------------------------------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 2** Parameters in the request header

   +--------------+-----------+--------+-------------------------------------------------------+
   | Parameter    | Mandatory | Type   | Description                                           |
   +==============+===========+========+=======================================================+
   | Content-Type | Yes       | String | Fill **application/json;charset=utf8** in this field. |
   +--------------+-----------+--------+-------------------------------------------------------+
   | X-Auth-Token | Yes       | String | Token with **Security Administrator** permissions.    |
   +--------------+-----------+--------+-------------------------------------------------------+

.. table:: **Table 3** Parameters in the request body

   +--------------------------------------------------------------------------------------------+-----------+--------+----------------------------+
   | Parameter                                                                                  | Mandatory | Type   | Description                |
   +============================================================================================+===========+========+============================+
   | :ref:`role <iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_request_rq114role>` | Yes       | Object | Custom policy information. |
   +--------------------------------------------------------------------------------------------+-----------+--------+----------------------------+

.. _iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_request_rq114role:

.. table:: **Table 4** role

   +----------------------------------------------------------------------------------------------------+-----------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                                                                                          | Mandatory       | Type            | Description                                                                                                                            |
   +====================================================================================================+=================+=================+========================================================================================================================================+
   | display_name                                                                                       | Yes             | String          | Display name of the custom policy.                                                                                                     |
   +----------------------------------------------------------------------------------------------------+-----------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | type                                                                                               | Yes             | String          | Display mode.                                                                                                                          |
   |                                                                                                    |                 |                 |                                                                                                                                        |
   |                                                                                                    |                 |                 | .. note::                                                                                                                              |
   |                                                                                                    |                 |                 |                                                                                                                                        |
   |                                                                                                    |                 |                 |    -  **AX**: Account level.                                                                                                           |
   |                                                                                                    |                 |                 |    -  **XA**: Project level.                                                                                                           |
   |                                                                                                    |                 |                 |    -  The display mode of a custom policy can only be **AX** or **XA**. A custom policy must be displayed at either of the two levels. |
   +----------------------------------------------------------------------------------------------------+-----------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | description                                                                                        | Yes             | String          | Description of the custom policy.                                                                                                      |
   +----------------------------------------------------------------------------------------------------+-----------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | description_cn                                                                                     | No              | String          | Description of the custom policy.                                                                                                      |
   +----------------------------------------------------------------------------------------------------+-----------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`policy <iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_request_rq114rolepolicy>` | Yes             | Object          | Content of custom policy.                                                                                                              |
   +----------------------------------------------------------------------------------------------------+-----------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------------+

.. _iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_request_rq114rolepolicy:

.. table:: **Table 5** role.policy

   +-----------------------------------------------------------------------------------------------------------------------+-----------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                                                                                                             | Mandatory       | Type             | Description                                                                                                                                   |
   +=======================================================================================================================+=================+==================+===============================================================================================================================================+
   | Version                                                                                                               | Yes             | String           | Policy version. When creating a custom policy, set this parameter to **1.1**.                                                                 |
   |                                                                                                                       |                 |                  |                                                                                                                                               |
   |                                                                                                                       |                 |                  | .. note::                                                                                                                                     |
   |                                                                                                                       |                 |                  |                                                                                                                                               |
   |                                                                                                                       |                 |                  |    -  **1.0**: System-defined role. Only a limited number of service-level roles are provided for authorization.                              |
   |                                                                                                                       |                 |                  |    -  **1.1**: Policy. A policy defines the permissions required to perform operations on a specific cloud resource under certain conditions. |
   +-----------------------------------------------------------------------------------------------------------------------+-----------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`Statement <iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_request_rq114rolepolicystatementarritem>` | Yes             | Array of objects | Statement of the policy. A policy can contain a maximum of eight statements.                                                                  |
   +-----------------------------------------------------------------------------------------------------------------------+-----------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+

.. _iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_request_rq114rolepolicystatementarritem:

.. table:: **Table 6** role.policy.Statement

   +------------------------------------------------------------------------------------------------------------------------------+-----------------+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                                                                                                                    | Mandatory       | Type             | Description                                                                                                                                                                                                                                                                                 |
   +==============================================================================================================================+=================+==================+=============================================================================================================================================================================================================================================================================================+
   | Action                                                                                                                       | Yes             | Array of strings | An action item is a specific operation permission on a resource.                                                                                                                                                                                                                            |
   |                                                                                                                              |                 |                  |                                                                                                                                                                                                                                                                                             |
   |                                                                                                                              |                 |                  | .. note::                                                                                                                                                                                                                                                                                   |
   |                                                                                                                              |                 |                  |                                                                                                                                                                                                                                                                                             |
   |                                                                                                                              |                 |                  |    -  For a custom policy for agencies, this parameter should be set to *"Action": ["``iam:agencies:assume``"]*.                                                                                                                                                                            |
   |                                                                                                                              |                 |                  |                                                                                                                                                                                                                                                                                             |
   |                                                                                                                              |                 |                  | Options:                                                                                                                                                                                                                                                                                    |
   |                                                                                                                              |                 |                  |                                                                                                                                                                                                                                                                                             |
   |                                                                                                                              |                 |                  | -  iam:agencies:assume                                                                                                                                                                                                                                                                      |
   +------------------------------------------------------------------------------------------------------------------------------+-----------------+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Effect                                                                                                                       | Yes             | String           | Effect of the permission. The value can be **Allow** or **Deny**. If both Allow and Deny statements are found in a policy, the authentication starts from the Deny statements.                                                                                                              |
   |                                                                                                                              |                 |                  |                                                                                                                                                                                                                                                                                             |
   |                                                                                                                              |                 |                  | Options:                                                                                                                                                                                                                                                                                    |
   |                                                                                                                              |                 |                  |                                                                                                                                                                                                                                                                                             |
   |                                                                                                                              |                 |                  | -  Allow                                                                                                                                                                                                                                                                                    |
   |                                                                                                                              |                 |                  | -  Deny                                                                                                                                                                                                                                                                                     |
   +------------------------------------------------------------------------------------------------------------------------------+-----------------+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`Resource <iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_request_rq114rolepolicystatementarritemresource>` | No              | Object           | Resources to be managed. After an account establishes multiple trust relationships between itself and your account, you can authorize IAM users in different user groups to manage resources of the delegating party. Each IAM user can only switch to the delegated agencies. For example: |
   |                                                                                                                              |                 |                  |                                                                                                                                                                                                                                                                                             |
   |                                                                                                                              |                 |                  | .. code-block::                                                                                                                                                                                                                                                                             |
   |                                                                                                                              |                 |                  |                                                                                                                                                                                                                                                                                             |
   |                                                                                                                              |                 |                  |    "Resource": {"uri": ["/iam/agencies/07805acaba800fdd4fbdc00b8f888c7c"]}                                                                                                                                                                                                                  |
   +------------------------------------------------------------------------------------------------------------------------------+-----------------+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_request_rq114rolepolicystatementarritemresource:

.. table:: **Table 7** role.policy.Statement.Resource

   +-----------------+-----------------+------------------+---------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type             | Description                                                                                                                     |
   +=================+=================+==================+=================================================================================================================================+
   | uri             | Yes             | Array of strings | URI of a delegated resource, which can contain a maximum of 128 characters. Format: /iam/agencies/*delegation ID*. For example: |
   |                 |                 |                  |                                                                                                                                 |
   |                 |                 |                  | .. code-block::                                                                                                                 |
   |                 |                 |                  |                                                                                                                                 |
   |                 |                 |                  |    "uri": ["/iam/agencies/07805acaba800fdd4fbdc00b8f888c7c"]                                                                    |
   +-----------------+-----------------+------------------+---------------------------------------------------------------------------------------------------------------------------------+

Response Parameters
-------------------

.. table:: **Table 8** Parameters in the response body

   +---------------------------------------------------------------------------------------------+--------+----------------------------+
   | Parameter                                                                                   | Type   | Description                |
   +=============================================================================================+========+============================+
   | :ref:`role <iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_response_rs114role>` | Object | Custom policy information. |
   +---------------------------------------------------------------------------------------------+--------+----------------------------+

.. _iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_response_rs114role:

.. table:: **Table 9** role

   +-----------------------------------------------------------------------------------------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                                                                                           | Type                  | Description                                                                                                                            |
   +=====================================================================================================+=======================+========================================================================================================================================+
   | catalog                                                                                             | String                | Service catalog.                                                                                                                       |
   +-----------------------------------------------------------------------------------------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | display_name                                                                                        | String                | Display name of the custom policy.                                                                                                     |
   +-----------------------------------------------------------------------------------------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | description                                                                                         | String                | Description of the custom policy.                                                                                                      |
   +-----------------------------------------------------------------------------------------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`links <iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_response_rs114rolelinks>`   | Object                | Resource link of the custom policy.                                                                                                    |
   +-----------------------------------------------------------------------------------------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`policy <iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_response_rs114rolepolicy>` | Object                | Content of custom policy.                                                                                                              |
   +-----------------------------------------------------------------------------------------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | description_cn                                                                                      | String                | Description of the custom policy.                                                                                                      |
   +-----------------------------------------------------------------------------------------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | domain_id                                                                                           | String                | Domain ID.                                                                                                                             |
   +-----------------------------------------------------------------------------------------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | type                                                                                                | String                | Display mode.                                                                                                                          |
   |                                                                                                     |                       |                                                                                                                                        |
   |                                                                                                     |                       | .. note::                                                                                                                              |
   |                                                                                                     |                       |                                                                                                                                        |
   |                                                                                                     |                       |    -  **AX**: Account level.                                                                                                           |
   |                                                                                                     |                       |    -  **XA**: Project level.                                                                                                           |
   |                                                                                                     |                       |    -  The display mode of a custom policy can only be **AX** or **XA**. A custom policy must be displayed at either of the two levels. |
   +-----------------------------------------------------------------------------------------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | id                                                                                                  | String                | Policy ID.                                                                                                                             |
   +-----------------------------------------------------------------------------------------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | name                                                                                                | String                | Name of the custom policy.                                                                                                             |
   +-----------------------------------------------------------------------------------------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | updated_time                                                                                        | String                | Time when the custom policy was last updated.                                                                                          |
   +-----------------------------------------------------------------------------------------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | created_time                                                                                        | String                | Time when the custom policy was created.                                                                                               |
   +-----------------------------------------------------------------------------------------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------+
   | references                                                                                          | String                | Number of references.                                                                                                                  |
   +-----------------------------------------------------------------------------------------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------+

.. _iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_response_rs114rolelinks:

.. table:: **Table 10** role.links

   ========= ====== ==============
   Parameter Type   Description
   ========= ====== ==============
   self      String Resource link.
   ========= ====== ==============

.. _iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_response_rs114rolepolicy:

.. table:: **Table 11** role.policy

   +------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                                                                                                              | Type                  | Description                                                                                                                                   |
   +========================================================================================================================+=======================+===============================================================================================================================================+
   | Version                                                                                                                | String                | Policy version.                                                                                                                               |
   |                                                                                                                        |                       |                                                                                                                                               |
   |                                                                                                                        |                       | .. note::                                                                                                                                     |
   |                                                                                                                        |                       |                                                                                                                                               |
   |                                                                                                                        |                       |    -  **1.0**: System-defined role. Only a limited number of service-level roles are provided for authorization.                              |
   |                                                                                                                        |                       |    -  **1.1**: Policy. A policy defines the permissions required to perform operations on a specific cloud resource under certain conditions. |
   +------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`Statement <iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_response_rs114rolepolicystatementarritem>` | Array of objects      | Statement of the policy. A policy can contain a maximum of eight statements.                                                                  |
   +------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+

.. _iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_response_rs114rolepolicystatementarritem:

.. table:: **Table 12** role.policy.Statement

   +-------------------------------------------------------------------------------------------------------------------------------+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                                                                                                                     | Type                  | Description                                                                                                                                                                                                                                                                                 |
   +===============================================================================================================================+=======================+=============================================================================================================================================================================================================================================================================================+
   | Action                                                                                                                        | Array of strings      | An action item is a specific operation permission on a resource.                                                                                                                                                                                                                            |
   |                                                                                                                               |                       |                                                                                                                                                                                                                                                                                             |
   |                                                                                                                               |                       | .. note::                                                                                                                                                                                                                                                                                   |
   |                                                                                                                               |                       |                                                                                                                                                                                                                                                                                             |
   |                                                                                                                               |                       |    -  For a custom policy for agencies, this parameter should be set to *"Action": ["``iam:agencies:assume``"]*.                                                                                                                                                                            |
   +-------------------------------------------------------------------------------------------------------------------------------+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Effect                                                                                                                        | String                | Effect of the permission. The value can be **Allow** or **Deny**. If both Allow and Deny statements are found in a policy, the authentication starts from the Deny statements.                                                                                                              |
   |                                                                                                                               |                       |                                                                                                                                                                                                                                                                                             |
   |                                                                                                                               |                       | Options:                                                                                                                                                                                                                                                                                    |
   |                                                                                                                               |                       |                                                                                                                                                                                                                                                                                             |
   |                                                                                                                               |                       | -  Allow                                                                                                                                                                                                                                                                                    |
   |                                                                                                                               |                       | -  Deny                                                                                                                                                                                                                                                                                     |
   +-------------------------------------------------------------------------------------------------------------------------------+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`Resource <iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_response_rs114rolepolicystatementarritemresource>` | Object                | Resources to be managed. After an account establishes multiple trust relationships between itself and your account, you can authorize IAM users in different user groups to manage resources of the delegating party. Each IAM user can only switch to the delegated agencies. For example: |
   |                                                                                                                               |                       |                                                                                                                                                                                                                                                                                             |
   |                                                                                                                               |                       | .. code-block::                                                                                                                                                                                                                                                                             |
   |                                                                                                                               |                       |                                                                                                                                                                                                                                                                                             |
   |                                                                                                                               |                       |    "Resource": {"uri": ["/iam/agencies/07805acaba800fdd4fbdc00b8f888c7c"]}                                                                                                                                                                                                                  |
   +-------------------------------------------------------------------------------------------------------------------------------+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _iam_11_0017__en-us_topic_0222393174_en-us_topic_0222037497_response_rs114rolepolicystatementarritemresource:

.. table:: **Table 13** role.policy.Statement.Resource

   +-----------------------+-----------------------+---------------------------------------------------------------------------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                                                                                     |
   +=======================+=======================+=================================================================================================================================+
   | uri                   | Array of strings      | URI of a delegated resource, which can contain a maximum of 128 characters. Format: /iam/agencies/*delegation ID*. For example: |
   |                       |                       |                                                                                                                                 |
   |                       |                       | .. code-block::                                                                                                                 |
   |                       |                       |                                                                                                                                 |
   |                       |                       |    "uri": ["/iam/agencies/07805acaba800fdd4fbdc00b8f888c7c"]                                                                    |
   +-----------------------+-----------------------+---------------------------------------------------------------------------------------------------------------------------------+

Example Request
---------------

.. code-block::

   PATCH https://iam.eu-de.otc.t-systems.com/v3.0/OS-ROLE/roles/{role_id}

.. code-block::

   {
       "role": {
           "display_name": "IAMAgencyPolicy",
           "type": "AX",
           "description": "IAMDescription",
           "description_cn": "Policy description",
           "policy": {
               "Version": "1.1",
               "Statement": [
                   {
                       "Effect": "Allow",
                       "Action": [
                           "iam:agencies:assume"
                       ],
                       "Resource": {
                           "uri": [
                               "/iam/agencies/07805acaba800fdd4fbdc00b8f888c7c"
                           ]
                       }
                   }
               ]
           }
       }
   }

Example Response
----------------

**Status code: 200**

The request is successful.

.. code-block::

   {
       "role": {
           "catalog": "CUSTOMED",
           "display_name": "IAMAgencyPolicy",
           "description": "IAMDescription",
           "links": {
               "self": "https://iam.eu-de.otc.t-systems.com/v3/roles/f67224e84dc849ab954ce29fb4f47f8e"
           },
           "policy": {
               "Version": "1.1",
               "Statement": [
                   {
                       "Action": [
                           "iam:agencies:assume"
                       ],
                       "Resource": {
                           "uri": [
                               "/iam/agencies/07805acaba800fdd4fbdc00b8f888c7c"
                           ]
                       },
                       "Effect": "Allow"
                   }
               ]
           },
           "description_cn": "Policy description",
           "domain_id": "d78cbac186b744899480f25b...",
           "type": "AX",
           "id": "f67224e84dc849ab954ce29fb4f47f8e",
           "name": "custom_d78cbac186b744899480f25bd022f468_0"
       }
   }

Status Codes
------------

=========== =========================================
Status Code Description
=========== =========================================
200         The request is successful.
400         The server failed to process the request.
401         Authentication failed.
403         Access denied.
500         Internal server error.
=========== =========================================

Error Codes
-----------

None
